<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTR hOCR Editor</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>HTR hOCR Editor</h1>
            <p>Advanced OCR correction with visual overlay and live editing</p>
        </div>

        <!-- Upload Section -->
        <div id="upload-section">
            <div class="upload-area" id="upload-area">
                <h3>Start New hOCR Correction Session</h3>
                <p>Upload images - they'll be processed with hOCR-capable OCR</p>
                <input type="file" id="file-input" accept=".jpg,.jpeg,.png,.gif,.csv" multiple style="margin: 20px 0;">
                <br>
                <button class="btn btn-primary" onclick="handleUpload()">Upload & Process</button>
            </div>
        </div>

        <!-- Sessions List -->
        <div class="session-list">
            <h3>Recent Sessions</h3>
            <div id="sessions-list">Loading...</div>
        </div>

        <!-- Correction Interface -->
        <div id="correction-section" class="hidden">
            <div class="controls">
                <div>
                    <span id="progress-text">Image 1 of 10</span>
                    <div class="progress">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="previousImage()">← Previous</button>
                    <button class="btn btn-success" onclick="saveAndNext()">Save & Next →</button>
                    <button class="btn btn-primary" onclick="finishSession()">Finish Session</button>
                </div>
            </div>

            <div class="correction-interface">
                <div class="image-panel">
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                        <button class="zoom-btn" onclick="zoomOut()">−</button>
                        <button class="zoom-btn" onclick="resetZoom()">⌂</button>
                    </div>
                    <div class="image-container" id="image-container">
                        <img id="current-image" src="" alt="OCR Image">
                        <div class="hocr-overlay" id="hocr-overlay"></div>
                    </div>
                </div>
                
                <div class="text-panel">
                    <div class="sidebar-section">
                        <h3>Navigation Controls</h3>
                        <div class="navigation-help">
                            <strong>Keyboard Shortcuts:</strong><br>
                            • <kbd>Tab</kbd> - Next word<br>
                            • <kbd>Shift+Tab</kbd> - Previous word<br>
                            • <kbd>Enter</kbd> - Apply changes<br>
                            • <kbd>Delete</kbd> - Delete selected word<br>
                            • <kbd>D</kbd> - Toggle drawing mode<br>
                            • <kbd>Esc</kbd> - Clear selection/Exit drawing
                        </div>
                        <div class="word-counter" id="word-counter">
                            Word 0 of 0
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>Selected Word</h3>
                        <div class="word-editor" id="word-editor" style="display: none;">
                            <h4 id="word-id">No word selected</h4>
                            <input type="text" class="word-input" id="word-text" placeholder="Edit word text..." oninput="updateSelectedWord()">
                            <div style="margin-top: 10px; font-size: 12px; color: #9ca3af;">
                                <div>Confidence: <span id="word-confidence"></span></div>
                                <div>Bbox: <span id="word-bbox"></span></div>
                            </div>
                        </div>
                        <div id="no-selection" style="color: #6b7280; font-style: italic;">
                            Click on a word in the image to edit it, or use Tab to navigate
                        </div>
                    </div>

                    <div class="sidebar-section">
                        <h3>hOCR Source</h3>
                        <textarea class="hocr-editor" id="hocr-editor" oninput="updateHOCRFromSource()" placeholder="hOCR XML will appear here..."></textarea>
                    </div>

                    <div class="sidebar-section">
                        <h3>Actions</h3>
                        <button class="btn btn-primary" id="drawing-mode-btn" onclick="toggleDrawingMode()" style="width: 100%; margin-bottom: 10px;">
                            ✏️ Draw New Word
                        </button>
                        <button class="btn btn-secondary" onclick="toggleLowConfidence()" style="width: 100%; margin-bottom: 10px;">
                            Highlight Low Confidence
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelectedWord()" style="width: 100%;">
                            Delete Selected Word
                        </button>
                    </div>
                </div>
            </div>

            <div class="metrics">
                <h3>Real-time Accuracy Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="char-similarity">0.000</div>
                        <div class="metric-label">Character Similarity</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="word-accuracy">0.000</div>
                        <div class="metric-label">Word Accuracy</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="word-error-rate">0.000</div>
                        <div class="metric-label">Word Error Rate</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="total-words">0</div>
                        <div class="metric-label">Total Words</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="avg-confidence">0</div>
                        <div class="metric-label">Avg Confidence</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="low-conf-words">0</div>
                        <div class="metric-label">Low Confidence Words</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Annotation Modal -->
        <div id="annotation-modal" class="annotation-modal hidden">
            <div class="annotation-dialog">
                <h3>Add New Word Annotation</h3>
                <input type="text" id="annotation-text" class="annotation-input" placeholder="Enter the word text..." autocomplete="off">
                <div class="dialog-buttons">
                    <button class="btn btn-secondary" onclick="cancelAnnotation()">Cancel</button>
                    <button class="btn btn-success" onclick="saveAnnotation()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
