<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>hOCR Edit</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=content_copy,delete,upload_file" />
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>hOCR Edit</h1>
            <p>Advanced hOCR correction with visual overlay and live editing</p>
        </div>

        <!-- Upload Section -->
        <div id="upload-section">
            <div class="upload-area" id="upload-area">
                <h3>Start New hOCR Correction Session</h3>
                <p>Upload images or provide an image URL - they'll be processed with hOCR-capable OCR</p>
                
                <!-- File Upload -->
                <div class="upload-method">
                    <h4>Upload from Computer</h4>
                    <input type="file" id="file-input" accept=".jpg,.jpeg,.png,.gif,.csv" multiple style="margin: 10px 0;">
                    <br>
                    <button class="btn btn-primary" onclick="handleUpload()">Upload & Process</button>
                </div>
                
                <!-- URL Input -->
                <div class="upload-method" style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #333;">
                    <h4>Process from Image URL</h4>
                    <input type="url" id="url-input" placeholder="https://example.com/image.jpg" style="width: 100%; margin: 10px 0; padding: 8px; border: 1px solid #333; background: #111; color: #fff; border-radius: 4px;">
                    <br>
                    <button class="btn btn-primary" onclick="handleUrlUpload()">Process URL</button>
                </div>
            </div>
        </div>

        <!-- Correction Interface -->
        <div id="correction-section" class="hidden">
            <div class="controls">
                <div>
                    <span id="progress-text">Image 1 of 10</span>
                    <div class="progress">
                        <div class="progress-bar" id="progress-bar"></div>
                    </div>
                </div>
                <div>
                    <button class="btn btn-secondary" onclick="previousImage()">← Previous</button>
                    <button class="btn btn-success" onclick="saveAndNext()">Save & Next →</button>
                    <button class="btn btn-primary" onclick="finishSession()">Finish Session</button>
                    <button id="save-islandora-btn" class="btn btn-drupal hidden" onclick="saveToIslandora()"><span class="material-symbols-outlined">upload_file</span> Save in Islandora</button>
                </div>
            </div>

            <div class="correction-interface">
                <div class="image-panel">
                    <div class="image-container" id="image-container">
                        <img id="current-image" src="" alt="OCR Image">
                        <div class="hocr-overlay" id="hocr-overlay"></div>
                        <div class="dimming-overlay" id="dimming-overlay"></div>
                    </div>
                </div>
                
                <div class="text-panel">
                    <div class="sidebar-section">
                        <h3>Line Editor</h3>
                        <div id="line-editor" style="display: none;">
                            <div class="line-info">
                                <span id="line-counter">Line 0 of 0</span>
                                <div class="line-navigation">
                                    <button class="btn-small" onclick="navigateToLineAbove()">↑ Prev Line</button>
                                    <button class="btn-small" onclick="navigateToLineBelow()">↓ Next Line</button>
                                </div>
                            </div>
                            <div class="line-text-editor">
                                <textarea id="line-text-area" class="line-textarea" placeholder="Line text will appear here..." oninput="updateLineText()"></textarea>
                                <div class="line-words" id="line-words">
                                    <!-- Individual word buttons will appear here -->
                                </div>
                            </div>
                            <div class="line-stats">
                                <span>Words: <span id="line-word-count">0</span></span>
                                <span>Avg Conf: <span id="line-avg-confidence">0%</span></span>
                            </div>
                        </div>
                        
                       
                        <div id="no-selection" style="color: #6b7280; font-style: italic;">
                            Click on a line in the image to edit it, or use arrow keys to navigate
                        </div>
                    </div>


                    <div class="sidebar-section">
                        <h3>Actions</h3>
                        <button class="btn btn-primary" id="drawing-mode-btn" onclick="toggleDrawingMode()" style="width: 100%; margin-bottom: 10px;">
                            ✏️ Draw New Line
                        </button>
                        <button class="btn btn-success" id="download-hocr-btn" onclick="downloadFormattedHocr()" style="width: 100%; margin-bottom: 10px;">
                            <span class="material-symbols-outlined">content_copy</span> Copy hOCR
                        </button>
                        <button class="btn btn-danger" onclick="deleteSelectedLine()" style="width: 100%;">
                            <span class="material-symbols-outlined">delete</span> Delete Selected Line
                        </button>
                    </div>
                    <div class="sidebar-section">
                        <h3>Navigation Controls</h3>
                        <div class="navigation-help">
                            <strong>Keyboard Shortcuts:</strong><br>
                            • <kbd>Tab</kbd> - Next line<br>
                            • <kbd>Shift+Tab</kbd> - Previous line<br>
                            • <kbd>Enter</kbd> - Apply changes<br>
                            • <kbd>Delete</kbd> - Delete selected line<br>
                            • <kbd>D</kbd> - Toggle drawing mode<br>
                            • <kbd>Esc</kbd> - Clear selection/Exit drawing
                        </div>
                        <div class="word-counter" id="word-counter">
                            Word 0 of 0
                        </div>
                    </div>
                </div>
            </div>

            <div class="metrics">
                <h3>Real-time Accuracy Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-value" id="char-similarity">0.000</div>
                        <div class="metric-label">Character Similarity</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="word-accuracy">0.000</div>
                        <div class="metric-label">Word Accuracy</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="word-error-rate">0.000</div>
                        <div class="metric-label">Word Error Rate</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="total-words">0</div>
                        <div class="metric-label">Total Words</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="avg-confidence">0</div>
                        <div class="metric-label">Avg Confidence</div>
                    </div>
                    <div class="metric">
                        <div class="metric-value" id="low-conf-words">0</div>
                        <div class="metric-label">Low Confidence Words</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Sessions List -->
        <div class="session-list">
            <h3>Recent Sessions</h3>
            <div id="sessions-list">Loading...</div>
        </div>
        <!-- Annotation Modal -->
        <div id="annotation-modal" class="annotation-modal hidden">
            <div class="annotation-dialog">
                <h3>Add New Line Annotation</h3>
                <input type="text" id="annotation-text" class="annotation-input" placeholder="Enter the line text (words separated by spaces)..." autocomplete="off">
                <div class="dialog-buttons">
                    <button class="btn btn-secondary" onclick="cancelAnnotation()">Cancel</button>
                    <button class="btn btn-success" onclick="saveAnnotation()">Save</button>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>
